# è°ƒåº¦è¾“å…¥æ–‡ä»¶ç”Ÿæˆè¯´æ˜

> **ç‰ˆæœ¬**: v1.0
> **æœ€åæ›´æ–°**: 2025-12-31
> **æ–‡ä»¶ä½ç½®**: `input_test.json` (é¡¹ç›®æ ¹ç›®å½•)

---

## ğŸ“‹ ç›®å½•

- [æ–‡æ¡£æ¦‚è¿°](#æ–‡æ¡£æ¦‚è¿°)
- [æ–‡ä»¶ç»“æ„æ€»è§ˆ](#æ–‡ä»¶ç»“æ„æ€»è§ˆ)
- [é…ç½®éƒ¨åˆ† (config)](#é…ç½®éƒ¨åˆ†-config)
- [èµ„æºéƒ¨åˆ† (resources)](#èµ„æºéƒ¨åˆ†-resources)
- [è®¢å•éƒ¨åˆ† (orders)](#è®¢å•éƒ¨åˆ†-orders)
- [äº§å“åº“éƒ¨åˆ† (product_library)](#äº§å“åº“éƒ¨åˆ†-product_library)
- [æ•°æ®ç”Ÿæˆè§„åˆ™](#æ•°æ®ç”Ÿæˆè§„åˆ™)
- [å·¥åºç±»å‹åŒ¹é…è§„åˆ™](#å·¥åºç±»å‹åŒ¹é…è§„åˆ™)
- [æ•°æ®çº¦æŸä¸éªŒè¯](#æ•°æ®çº¦æŸä¸éªŒè¯)
- [å®Œæ•´ç¤ºä¾‹](#å®Œæ•´ç¤ºä¾‹)
- [å¸¸è§é—®é¢˜](#å¸¸è§é—®é¢˜)
- [ç›¸å…³æ–‡ä»¶](#ç›¸å…³æ–‡ä»¶)

---

## æ–‡æ¡£æ¦‚è¿°

### ç”¨é€”

`input_test.json` æ˜¯è°ƒåº¦ç®—æ³•çš„è¾“å…¥æ•°æ®æ–‡ä»¶ï¼ŒåŒ…å«äº†è°ƒåº¦æ‰€éœ€çš„å…¨éƒ¨ä¿¡æ¯ï¼š

- **å·¥ä½œæ—¥å†é…ç½®**: å®šä¹‰å·¥ä½œæ—¶é—´ã€å‡æœŸ
- **èµ„æºä¿¡æ¯**: ç­ç»„ã€å·¥ä½ã€è®¾å¤‡åŠå…¶èƒ½åŠ›
- **è®¢å•æ•°æ®**: å¾…æ’ç¨‹çš„ç”Ÿäº§è®¢å•
- **äº§å“åº“**: äº§å“å·¥è‰ºè·¯çº¿å®šä¹‰

### ç”Ÿæˆæ–¹å¼

è¯¥æ–‡ä»¶ç”±å‰ç«¯è°ƒç”¨ API æ¥å£ `/api/scheduling-test/save-input` è‡ªåŠ¨ç”Ÿæˆï¼Œæ•°æ®æ¥æºäºï¼š

1. åç«¯æ•°æ®åº“çš„ç”Ÿäº§ä»»åŠ¡æ•°æ®
2. å‰ç«¯ `schedulingAdapter.ts` çš„è½¬æ¢é€»è¾‘
3. ç³»ç»Ÿé…ç½®çš„æ—¥å†å’Œèµ„æºä¿¡æ¯

---

## æ–‡ä»¶ç»“æ„æ€»è§ˆ

```json
{
  "config": {
    "work_calendar": { ... },
    "resources": { ... }
  },
  "resources": {
    "teams": [ ... ],
    "stations": [ ... ],
    "machines": [ ... ]
  },
  "orders": [ ... ],
  "product_library": [ ... ]
}
```

### é¡¶å±‚ç»“æ„

| å­—æ®µ | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|------|------|------|------|
| `config` | Object | âœ“ | ç³»ç»Ÿé…ç½®ä¿¡æ¯ |
| `resources` | Object | âœ“ | å¯ç”¨èµ„æºå®šä¹‰ |
| `orders` | Array | âœ“ | å¾…æ’ç¨‹è®¢å•åˆ—è¡¨ |
| `product_library` | Array | âœ“ | äº§å“å·¥è‰ºå®šä¹‰åº“ |

---

## é…ç½®éƒ¨åˆ† (config)

### ç»“æ„è¯´æ˜

```json
{
  "config": {
    "work_calendar": {
      "start_date": "2025-12-30",
      "start_hour": 8,
      "schedule": {
        "upstart_time": 8,
        "upend_time": 12,
        "downstart_time": 14,
        "downend_time": 18
      },
      "holidays": ["2026-01-01", "2026-01-02"]
    },
    "resources": {
      "crews": ["ä¸€å·è£…é…ç­ç»„", "äºŒå·è£…é…ç­ç»„"],
      "machines": ["æ•°æ§æœºåºŠ-7", "å·¥ä¸šæœºå™¨äºº-8"],
      "part_stations": [],
      "final_stations": []
    }
  }
}
```

### å­—æ®µè¯¦è§£

#### work_calendar (å·¥ä½œæ—¥å†)

| å­—æ®µ | ç±»å‹ | è¯´æ˜ | ç¤ºä¾‹ |
|------|------|------|------|
| `start_date` | String | æ’ç¨‹å¼€å§‹æ—¥æœŸ (YYYY-MM-DD) | "2025-12-30" |
| `start_hour` | Number | æ¯æ—¥å·¥ä½œå¼€å§‹å°æ—¶ (0-23) | 8 |
| `schedule` | Object | æ¯æ—¥å·¥ä½œæ—¶é—´æ®µé…ç½® | è§ä¸‹è¡¨ |
| `holidays` | Array\<String\> | å‡æœŸæ—¥æœŸåˆ—è¡¨ (YYYY-MM-DD) | ["2026-01-01"] |

#### schedule (å·¥ä½œæ—¶é—´æ®µ)

| å­—æ®µ | ç±»å‹ | è¯´æ˜ | ç¤ºä¾‹ |
|------|------|------|------|
| `upstart_time` | Number | ä¸Šåˆå¼€å§‹æ—¶é—´ (å°æ—¶) | 8 |
| `upend_time` | Number | ä¸Šåˆç»“æŸæ—¶é—´ (å°æ—¶) | 12 |
| `downstart_time` | Number | ä¸‹åˆå¼€å§‹æ—¶é—´ (å°æ—¶) | 14 |
| `downend_time` | Number | ä¸‹åˆç»“æŸæ—¶é—´ (å°æ—¶) | 18 |

**é»˜è®¤å€¼**: 8-12, 14-18 (å›ºå®šé…ç½®)

#### resources (èµ„æºåç§°åˆ—è¡¨)

| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| `crews` | Array\<String\> | ç­ç»„åç§°åˆ—è¡¨ |
| `machines` | Array\<String\> | è®¾å¤‡åç§°åˆ—è¡¨ |
| `part_stations` | Array\<String\> | éƒ¨è£…å·¥ä½åç§°åˆ—è¡¨ (type=0) |
| `final_stations` | Array\<String\> | æ€»è£…å·¥ä½åç§°åˆ—è¡¨ (type=1) |

**æ³¨æ„**: æµ‹è¯•å·¥ä½ (type=2) ä¸åœ¨ part_stations å’Œ final_stations ä¸­ã€‚

---

## èµ„æºéƒ¨åˆ† (resources)

### teams (ç­ç»„)

```json
{
  "id": "6",
  "code": "TEAM-001",
  "name": "ä¸€å·è£…é…ç­ç»„",
  "capabilities": [
    "PROCXXGTZZ01",
    "PROCZXGTZZ01",
    "PROCZXYTZZ01"
  ]
}
```

| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| `id` | String | ç­ç»„å”¯ä¸€æ ‡è¯† (æ•°æ®åº“IDè½¬å­—ç¬¦ä¸²) |
| `code` | String | ç­ç»„ç¼–ç  |
| `name` | String | ç­ç»„åç§° |
| `capabilities` | Array\<String\> | **çœŸå®èƒ½åŠ›** - ä»æ•°æ®åº“è¯»å–çš„å·¥åºç¼–ç åˆ—è¡¨ |

**èƒ½åŠ›æ¥æº**: ä¿ç•™åç«¯æ•°æ®åº“ä¸­çš„çœŸå®ç­ç»„èƒ½åŠ›é…ç½®ã€‚

---

### stations (å·¥ä½)

```json
{
  "id": "42",
  "code": "GW-CS-YT-05",
  "name": "æ¶²ä½“ç«ç®­ä½æ¸©æµ‹è¯•å·¥ä½",
  "type": 2,
  "capabilities": [
    "PROCZXYTZZ01",
    "PROCZXYTBZ01",
    "PROCZXYTJG101"
  ]
}
```

| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| `id` | String | å·¥ä½å”¯ä¸€æ ‡è¯† (æ•°æ®åº“IDè½¬å­—ç¬¦ä¸²) |
| `code` | String | å·¥ä½ç¼–ç  |
| `name` | String | å·¥ä½åç§° |
| `type` | Number | å·¥ä½ç±»å‹: 0=éƒ¨è£…, 1=æ€»è£…, 2=æµ‹è¯• |
| `capabilities` | Array\<String\> | **åŠ¨æ€åŒ¹é…** - åŸºäºå·¥åºç±»å‹è¿‡æ»¤çš„å·¥åºç¼–ç åˆ—è¡¨ |

**èƒ½åŠ›æ¥æº**:

- **æ–°é€»è¾‘ (v1.0)**: æ ¹æ®å·¥ä½ç¼–ç ä¸­çš„å·¥åºç±»å‹æ ‡è¯†ï¼ˆGT/YTï¼‰åŠ¨æ€åŒ¹é…å·¥åº
- **æ—§é€»è¾‘**: ä½¿ç”¨å…¨é‡å·¥åºç¼–ç ï¼ˆå·²åºŸå¼ƒï¼‰

**å·¥åºç±»å‹åŒ¹é…è§„åˆ™**:
- `GW-CS-GT-xx` (å›ºä½“å·¥ä½) â†’ åªèƒ½æ‰§è¡ŒåŒ…å« `GT` çš„å·¥åº
- `GW-CS-YT-xx` (æ¶²ä½“å·¥ä½) â†’ åªèƒ½æ‰§è¡ŒåŒ…å« `YT` çš„å·¥åº
- æ— ç±»å‹æ ‡è¯† â†’ å¯æ‰§è¡Œæ‰€æœ‰å·¥åº

---

### machines (è®¾å¤‡)

```json
{
  "id": "7",
  "code": "SB-0106",
  "name": "æ•°æ§æœºåºŠ-7",
  "capabilities": [
    "PROCZXGTZZ01",
    "PROCZXGTZZ02",
    ...å…¨éƒ¨å·¥åº
  ]
}
```

| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| `id` | String | è®¾å¤‡å”¯ä¸€æ ‡è¯† (æ•°æ®åº“IDè½¬å­—ç¬¦ä¸²) |
| `code` | String | è®¾å¤‡ç¼–ç  |
| `name` | String | è®¾å¤‡åç§° |
| `capabilities` | Array\<String\> | **å…¨é‡å·¥åº** - æ‰€æœ‰ä»»åŠ¡æ¶‰åŠçš„å·¥åºç¼–ç  |

**èƒ½åŠ›æ¥æº**: ä½¿ç”¨å…¨é‡å·¥åºç¼–ç ï¼ˆä¿æŒå…¨èƒ½ï¼‰ã€‚

---

## è®¢å•éƒ¨åˆ† (orders)

### ç»“æ„è¯´æ˜

```json
{
  "Order_code": "ORD-2025-122502",
  "Order_name": "ä¸­å°å‹ä½“ç«ç®­å‘å°„",
  "products": [
    {
      "product_id": "10",
      "product_code": "ZXGTHJ001",
      "quantity": 1
    }
  ],
  "queue": 1,
  "quantity": 1,
  "deadline": "2026-04-29T16:00:00.000Z"
}
```

### å­—æ®µè¯¦è§£

| å­—æ®µ | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|------|------|------|------|
| `Order_code` | String | âœ“ | è®¢å•ç¼–ç  |
| `Order_name` | String | âœ“ | è®¢å•åç§° |
| `products` | Array\<Object\> | âœ“ | è®¢å•åŒ…å«çš„äº§å“åˆ—è¡¨ |
| `queue` | Number | âœ“ | è®¢å•ä¼˜å…ˆçº§ (æ•°å­—è¶Šå°ä¼˜å…ˆçº§è¶Šé«˜) |
| `quantity` | Number | âœ“ | è®¢å•æ•°é‡ |
| `deadline` | String\|null | - | äº¤ä»˜æˆªæ­¢æ—¥æœŸ (ISO 8601æ ¼å¼) |

### products (äº§å“é¡¹)

| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| `product_id` | String | äº§å“å®ä¾‹å”¯ä¸€æ ‡è¯† (æ•°æ®åº“ID) |
| `product_code` | String | äº§å“ç¼–ç  (å¯¹åº”äº§å“åº“ä¸­çš„ code) |
| `quantity` | Number | è¯¥äº§å“æ•°é‡ |

**æ•°æ®æ¥æº**:
- ä¸»äº§å“: ä»ç”Ÿäº§ä»»åŠ¡çš„å…³è”äº§å“è·å–
- éƒ¨è£…äº§å“: ä»ç”Ÿäº§ä»»åŠ¡çš„ steps ä¸­æå–

---

## äº§å“åº“éƒ¨åˆ† (product_library)

### ç»“æ„è¯´æ˜

```json
{
  "code": "ZXGTHJ001",
  "name": "ä¸­å°å‹å›ºä½“ç«ç®­B",
  "tasks": [
    {
      "id": "64",
      "code": "PROCZXGTZZ01",
      "name": "ä¸­å°å‹å›ºä½“è¡¨é¢å¤„ç†",
      "process_code": "PROCZXGTZZ01",
      "process_id": "64",
      "process_name": "ä¸­å°å‹å›ºä½“è¡¨é¢å¤„ç†",
      "task_code": "PROCZXGTZZ01",
      "task_id": "64",
      "queue": 10,
      "duration": 3600,
      "operations": [
        {
          "name": "StandardOp",
          "duration": 3600,
          "allowed_machines": ["æ•°æ§æœºåºŠ-7", "å·¥ä¸šæœºå™¨äºº-8"]
        }
      ]
    }
  ]
}
```

### Product å­—æ®µ

| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| `code` | String | äº§å“ç¼–ç  (å”¯ä¸€æ ‡è¯†) |
| `name` | String | äº§å“åç§° |
| `tasks` | Array\<Task\> | äº§å“åŒ…å«çš„å·¥åºåˆ—è¡¨ (æŒ‰ queue æ’åº) |

### Task å­—æ®µ

| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| `id` | String | å·¥åºå”¯ä¸€æ ‡è¯† |
| `code` | String | å·¥åºç¼–ç  |
| `name` | String | å·¥åºåç§° |
| `process_code` | String | å·¥åºä»£ç  (åŒ code) |
| `process_id` | String | å·¥åºID (åŒ id) |
| `process_name` | String | å·¥åºåç§° (åŒ name) |
| `task_code` | String | ä»»åŠ¡ä»£ç  (åŒ code) |
| `task_id` | String | ä»»åŠ¡ID (åŒ id) |
| `queue` | Number | å·¥åºåœ¨äº§å“ä¸­çš„é¡ºåº (10, 20, 30...) |
| `duration` | Number | **å·¥åºæŒç»­æ—¶é—´ (åˆ†é’Ÿ)** |
| `operations` | Array\<Operation\> | å·¥åºåŒ…å«çš„æ“ä½œåˆ—è¡¨ |

**æ—¶é—´å•ä½è½¬æ¢**:
- æ•°æ®åº“å­˜å‚¨: **å°æ—¶** (hours)
- è°ƒåº¦è¾“å…¥: **åˆ†é’Ÿ** (minutes)
- è½¬æ¢å…¬å¼: `duration_minutes = duration_hours * 60`

### Operation å­—æ®µ

| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| `name` | String | æ“ä½œåç§° (å›ºå®šä¸º "StandardOp") |
| `duration` | Number | æ“ä½œæŒç»­æ—¶é—´ (åˆ†é’Ÿï¼ŒåŒ Task.duration) |
| `allowed_machines` | Array\<String\> | å…è®¸æ‰§è¡Œæ­¤æ“ä½œçš„è®¾å¤‡åç§°åˆ—è¡¨ |

**allowed_machines æ¥æº**: ä½¿ç”¨æ‰€æœ‰è®¾å¤‡çš„åç§°åˆ—è¡¨ã€‚

---

## æ•°æ®ç”Ÿæˆè§„åˆ™

### è½¬æ¢æµç¨‹

```
åç«¯æ•°æ®åº“æ•°æ®
    â†“
API: /api/production-tasks/:id/scheduling-input
    â†“
schedulingAdapter.ts è½¬æ¢
    â†“
API: /api/scheduling-test/save-input
    â†“
input_test.json (æ ¹ç›®å½•)
```

### æ ¸å¿ƒè½¬æ¢é€»è¾‘

**æ–‡ä»¶ä½ç½®**: `frontend/src/utils/schedulingAdapter.ts`

#### 1. å·¥åºç¼–ç æå– (extractAllProcessCodes)

ä»æ‰€æœ‰ä»»åŠ¡ä¸­æå–å»é‡åçš„å·¥åºç¼–ç ï¼š

```typescript
// éå†ä»»åŠ¡ â†’ äº§å“ â†’ å·¥è‰ºè·¯çº¿ â†’ å·¥åº
tasks â†’ product.routings â†’ processes â†’ process.code
tasks â†’ steps â†’ product.routings â†’ processes â†’ process.code
```

#### 2. èµ„æºè½¬æ¢ (transformResources)

```typescript
// ç­ç»„: ä¿ç•™çœŸå® capabilities
teams.capabilities = æ•°æ®åº“ä¸­çš„çœŸå®èƒ½åŠ›åˆ—è¡¨

// è®¾å¤‡: å…¨é‡å·¥åºç¼–ç 
machines.capabilities = allProcessCodes

// å·¥ä½: åŸºäºå·¥åºç±»å‹åŠ¨æ€åŒ¹é…
stations.capabilities = filterProcessCodesByType(station.code, allProcessCodes)
```

#### 3. è®¢å•è½¬æ¢ (transformOrders)

```typescript
// ä¸»äº§å“
products.push({
  product_id: task.product.id,
  product_code: task.product.code,
  quantity: task.order.quantity
})

// éƒ¨è£…äº§å“ (ä» steps æå–)
task.steps.forEach(step => {
  if (step.product.id !== task.product.id) {
    products.push({
      product_id: step.product.id,
      product_code: step.product.code,
      quantity: 1
    })
  }
})
```

#### 4. äº§å“åº“æ„å»º (buildProductLibrary)

```typescript
// æ”¶é›†æ‰€æœ‰æ¶‰åŠçš„äº§å“
productMap = {}

// ä»ä»»åŠ¡ä¸»äº§å“æ·»åŠ 
addProductToLibrary(productMap, task.product, machineNames)

// ä» steps äº§å“æ·»åŠ 
task.steps.forEach(step => {
  addProductToLibrary(productMap, step.product, machineNames)
})

// è½¬æ¢å·¥åº
product.routings.processes.forEach(process => {
  tasks.push({
    ...process,
    duration: process.duration * 60, // å°æ—¶ â†’ åˆ†é’Ÿ
    operations: [{
      name: 'StandardOp',
      duration: process.duration * 60,
      allowed_machines: machineNames // æ‰€æœ‰è®¾å¤‡åç§°
    }]
  })
})
```

---

## å·¥åºç±»å‹åŒ¹é…è§„åˆ™

### èƒŒæ™¯

å·¥åºç¼–ç å’Œå·¥ä½ç¼–ç ä¸­åŒ…å«å·¥åºç±»å‹æ ‡è¯†ï¼š

- **GT**: å›ºä½“å·¥åº (å¦‚ `PROCZXGTZZ01`, `GW-CS-GT-01`)
- **YT**: æ¶²ä½“å·¥åº (å¦‚ `PROCZXYTWG04`, `GW-CS-YT-05`)

### åŒ¹é…é€»è¾‘

**æ–‡ä»¶ä½ç½®**: `frontend/src/utils/schedulingAdapter.ts`

#### extractProcessType(code)

æå–ç¼–ç ä¸­çš„å·¥åºç±»å‹æ ‡è¯†ï¼š

```typescript
function extractProcessType(code: string): string | null {
  const upperCode = code.toUpperCase();

  if (upperCode.includes('GT')) return 'GT';
  if (upperCode.includes('YT')) return 'YT';

  return null; // æ— ç±»å‹æ ‡è¯†
}
```

#### filterProcessCodesByType(resourceCode, allProcessCodes)

æ ¹æ®èµ„æºç±»å‹è¿‡æ»¤å¯æ‰§è¡Œçš„å·¥åºç¼–ç ï¼š

```typescript
function filterProcessCodesByType(
  resourceCode: string,
  allProcessCodes: string[]
): string[] {
  const resourceType = extractProcessType(resourceCode);

  // æ— ç±»å‹æ ‡è¯† â†’ è¿”å›æ‰€æœ‰å·¥åº
  if (!resourceType) {
    return allProcessCodes;
  }

  // åªè¿”å›ä¸èµ„æºç±»å‹åŒ¹é…çš„å·¥åº
  return allProcessCodes.filter(processCode => {
    const processType = extractProcessType(processCode);
    // å·¥åºæ— ç±»å‹æ ‡è¯† æˆ– ç±»å‹åŒ¹é… â†’ å…è®¸
    return !processType || processType === resourceType;
  });
}
```

### åŒ¹é…ç¤ºä¾‹

| å·¥ä½ç¼–ç  | å·¥ä½ç±»å‹ | å¯æ‰§è¡Œå·¥åº | ä¸å¯æ‰§è¡Œå·¥åº |
|---------|---------|-----------|-------------|
| `GW-CS-GT-01` | GT (å›ºä½“) | PROCZXGTZZ01, PROCXXGTJG101 | PROCZXYTZZ01, PROCZXYTWG01 |
| `GW-CS-YT-05` | YT (æ¶²ä½“) | PROCZXYTZZ01, PROCZXYTWG04 | PROCZXGTZZ01, PROCXXGTJG101 |
| `GW-UNKNOWN-01` | æ— æ ‡è¯† | æ‰€æœ‰å·¥åº | - |

### éªŒè¯æµ‹è¯•

å¯è¿è¡Œä»¥ä¸‹å‘½ä»¤æµ‹è¯•åŒ¹é…é€»è¾‘ï¼š

```bash
node test-station-matching.js
```

é¢„æœŸç»“æœï¼š
- GTå·¥ä½åªåŒ¹é…GTå·¥åº âœ“
- YTå·¥ä½åªåŒ¹é…YTå·¥åº âœ“
- GTå·¥ä½ä¸åŒ…å«çº¯YTå·¥åº âœ“
- YTå·¥ä½ä¸åŒ…å«çº¯GTå·¥åº âœ“

---

## æ•°æ®çº¦æŸä¸éªŒè¯

### å¿…å¡«å­—æ®µæ£€æŸ¥

| éƒ¨åˆ† | å¿…å¡«å­—æ®µ |
|------|---------|
| config | work_calendar, resources |
| resources | teams, stations, machines |
| orders | Order_code, products, queue, quantity |
| products | product_id, product_code, quantity |
| product_library | code, name, tasks |
| tasks | process_code, queue, duration, operations |

### æ•°æ®ç±»å‹çº¦æŸ

```typescript
// ID å­—æ®µç»Ÿä¸€è½¬æ¢ä¸º string
id: String(dbId)

// æ—¶é—´å•ä½è½¬æ¢
duration_minutes = duration_hours * 60

// æ—¥æœŸæ ¼å¼
date: "YYYY-MM-DD"
datetime: "YYYY-MM-DDTHH:mm:ss.sssZ" (ISO 8601)

// å·¥ä½ç±»å‹æšä¸¾
type: 0 | 1 | 2  // éƒ¨è£… | æ€»è£… | æµ‹è¯•
```

### ä¸šåŠ¡è§„åˆ™éªŒè¯

#### 1. äº§å“åº“å®Œæ•´æ€§

è®¢å•ä¸­å¼•ç”¨çš„ `product_code` å¿…é¡»åœ¨ `product_library` ä¸­å­˜åœ¨ã€‚

```javascript
// éªŒè¯é€»è¾‘
const productCodes = new Set(product_library.map(p => p.code));
orders.forEach(order => {
  order.products.forEach(product => {
    if (!productCodes.has(product.product_code)) {
      throw new Error(`äº§å“ ${product.product_code} ä¸åœ¨äº§å“åº“ä¸­`);
    }
  });
});
```

#### 2. å·¥åºé¡ºåºåˆæ³•æ€§

äº§å“å·¥åºçš„ `queue` å¿…é¡»å•è°ƒé€’å¢ã€‚

```javascript
// éªŒè¯é€»è¾‘
product.tasks.forEach((task, index) => {
  if (index > 0 && task.queue <= product.tasks[index - 1].queue) {
    throw new Error(`äº§å“ ${product.code} çš„å·¥åºé¡ºåºä¸åˆæ³•`);
  }
});
```

#### 3. æ—¶é—´é…ç½®åˆæ³•æ€§

å·¥ä½œæ—¶é—´æ®µä¸èƒ½é‡å ä¸”å¿…é¡»åœ¨ 0-24 å°æ—¶èŒƒå›´å†…ã€‚

```javascript
// éªŒè¯é€»è¾‘
const { upstart_time, upend_time, downstart_time, downend_time } = schedule;

if (upstart_time >= upend_time || downstart_time >= downend_time) {
  throw new Error('å·¥ä½œæ—¶é—´æ®µé…ç½®ä¸åˆæ³•');
}

if (upend_time > downstart_time) {
  throw new Error('ä¸Šåˆå’Œä¸‹åˆæ—¶é—´æ®µé‡å ');
}
```

#### 4. èµ„æºåç§°ä¸€è‡´æ€§

`config.resources` ä¸­çš„åç§°å¿…é¡»ä¸ `resources` ä¸­çš„å®é™…åç§°ä¸€è‡´ã€‚

```javascript
// éªŒè¯é€»è¾‘
const actualCrewNames = resources.teams.map(t => t.name);
const configCrewNames = config.resources.crews;

const missingCrews = configCrewNames.filter(name => !actualCrewNames.includes(name));
if (missingCrews.length > 0) {
  throw new Error(`é…ç½®ä¸­çš„ç­ç»„ ${missingCrews} ä¸å­˜åœ¨`);
}
```

---

## å®Œæ•´ç¤ºä¾‹

### æœ€å°åŒ–ç¤ºä¾‹

```json
{
  "config": {
    "work_calendar": {
      "start_date": "2025-12-30",
      "start_hour": 8,
      "schedule": {
        "upstart_time": 8,
        "upend_time": 12,
        "downstart_time": 14,
        "downend_time": 18
      },
      "holidays": []
    },
    "resources": {
      "crews": ["ä¸€å·ç­ç»„"],
      "machines": ["è®¾å¤‡-1"],
      "part_stations": [],
      "final_stations": []
    }
  },
  "resources": {
    "teams": [
      {
        "id": "1",
        "code": "TEAM-001",
        "name": "ä¸€å·ç­ç»„",
        "capabilities": ["PROC001"]
      }
    ],
    "stations": [
      {
        "id": "1",
        "code": "GW-CS-GT-01",
        "name": "å›ºä½“å·¥ä½1å·",
        "type": 0,
        "capabilities": ["PROC001"]
      }
    ],
    "machines": [
      {
        "id": "1",
        "code": "SB-001",
        "name": "è®¾å¤‡-1",
        "capabilities": ["PROC001"]
      }
    ]
  },
  "orders": [
    {
      "Order_code": "ORD-001",
      "Order_name": "è®¢å•1",
      "products": [
        {
          "product_id": "1",
          "product_code": "PROD001",
          "quantity": 1
        }
      ],
      "queue": 1,
      "quantity": 1,
      "deadline": null
    }
  ],
  "product_library": [
    {
      "code": "PROD001",
      "name": "äº§å“1",
      "tasks": [
        {
          "id": "1",
          "code": "PROC001",
          "name": "å·¥åº1",
          "process_code": "PROC001",
          "process_id": "1",
          "process_name": "å·¥åº1",
          "task_code": "PROC001",
          "task_id": "1",
          "queue": 10,
          "duration": 60,
          "operations": [
            {
              "name": "StandardOp",
              "duration": 60,
              "allowed_machines": ["è®¾å¤‡-1"]
            }
          ]
        }
      ]
    }
  ]
}
```

### å®é™…æ•°æ®ç¤ºä¾‹

è¯·å‚è€ƒé¡¹ç›®æ ¹ç›®å½•ä¸‹çš„ `input_test.json` æ–‡ä»¶ã€‚

---

## å¸¸è§é—®é¢˜

### 1. ä¸ºä»€ä¹ˆå·¥ä½çš„ capabilities å’Œè®¾å¤‡çš„ capabilities ä¸åŒï¼Ÿ

**ç­”**:

- **å·¥ä½ capabilities**: æ ¹æ®å·¥åºç±»å‹åŠ¨æ€åŒ¹é…ï¼ˆGTå·¥ä½åªèƒ½æ‰§è¡ŒGTå·¥åºï¼‰
- **è®¾å¤‡ capabilities**: ä½¿ç”¨å…¨é‡å·¥åºç¼–ç ï¼ˆä¿æŒé€šç”¨æ€§ï¼‰
- **ç­ç»„ capabilities**: ä½¿ç”¨æ•°æ®åº“çœŸå®é…ç½®ï¼ˆåæ˜ å®é™…èƒ½åŠ›ï¼‰

è¿™æ ·è®¾è®¡æ˜¯ä¸ºäº†åœ¨ä¿æŒçµæ´»æ€§çš„åŒæ—¶ï¼Œç¡®ä¿å·¥ä½ç±»å‹çº¦æŸçš„å‡†ç¡®æ€§ã€‚

### 2. å¦‚ä½•æ·»åŠ æ–°çš„å·¥åºç±»å‹æ ‡è¯†ï¼Ÿ

**ä¿®æ”¹ä½ç½®**: `frontend/src/utils/schedulingAdapter.ts`

```typescript
function extractProcessType(code: string): string | null {
  const upperCode = code.toUpperCase();

  if (upperCode.includes('GT')) return 'GT';
  if (upperCode.includes('YT')) return 'YT';
  // æ·»åŠ æ–°ç±»å‹
  if (upperCode.includes('HT')) return 'HT'; // æ··åˆå‹

  return null;
}
```

### 3. ä¸ºä»€ä¹ˆå·¥åºæ—¶é—´å•ä½æ˜¯åˆ†é’Ÿè€Œä¸æ˜¯å°æ—¶ï¼Ÿ

**ç­”**:

- **æ•°æ®åº“å­˜å‚¨**: ä½¿ç”¨å°æ—¶ (ä¾¿äºäººå·¥å½•å…¥å’ŒæŸ¥çœ‹)
- **è°ƒåº¦ç®—æ³•**: ä½¿ç”¨åˆ†é’Ÿ (æé«˜ç²¾åº¦ï¼Œé¿å…æµ®ç‚¹è¿ç®—)
- **è½¬æ¢æ—¶æœº**: åœ¨ `buildProductLibrary` å‡½æ•°ä¸­è‡ªåŠ¨è½¬æ¢

### 4. å¦‚ä½•éªŒè¯ç”Ÿæˆçš„è¾“å…¥æ–‡ä»¶æ˜¯å¦æ­£ç¡®ï¼Ÿ

**éªŒè¯æ­¥éª¤**:

1. **ç»“æ„éªŒè¯**: æ£€æŸ¥æ˜¯å¦åŒ…å«å››å¤§éƒ¨åˆ†ï¼ˆconfig, resources, orders, product_libraryï¼‰
2. **å¼•ç”¨éªŒè¯**: è®¢å•ä¸­çš„ product_code æ˜¯å¦åœ¨äº§å“åº“ä¸­å­˜åœ¨
3. **ç±»å‹éªŒè¯**: å·¥ä½ç±»å‹åŒ¹é…æ˜¯å¦æ­£ç¡®ï¼ˆè¿è¡Œ `test-station-matching.js`ï¼‰
4. **æ—¶é—´éªŒè¯**: å·¥åºæ—¶é—´å•ä½æ˜¯å¦ä¸ºåˆ†é’Ÿï¼ˆä¸æ˜¯å°æ—¶ï¼‰
5. **åç§°éªŒè¯**: config.resources ä¸­çš„åç§°æ˜¯å¦ä¸ resources ä¸­ä¸€è‡´

### 5. å¦‚æœè®¢å•ä¸­æ²¡æœ‰æ¶²ä½“ç«ç®­äº§å“ï¼ŒYTå·¥ä½ä¼šæ€æ ·ï¼Ÿ

**ç­”**: YTå·¥ä½çš„ capabilities å°†ä¸ºç©ºæ•°ç»„ `[]`ï¼Œè¿™æ˜¯æ­£å¸¸ç°è±¡ã€‚è°ƒåº¦ç®—æ³•ä¼šè‡ªåŠ¨è·³è¿‡æ— å¯ç”¨å·¥åºçš„å·¥ä½ã€‚

### 6. å¦‚ä½•æ‰‹åŠ¨ä¿®æ”¹ input_test.jsonï¼Ÿ

**æ³¨æ„äº‹é¡¹**:

1. **ä¿æŒJSONæ ¼å¼æ­£ç¡®**: ä½¿ç”¨JSONéªŒè¯å·¥å…·æ£€æŸ¥è¯­æ³•
2. **ä¿æŒIDç±»å‹ä¸€è‡´**: æ‰€æœ‰IDå­—æ®µå¿…é¡»æ˜¯å­—ç¬¦ä¸²ç±»å‹
3. **ä¿æŒæ—¶é—´å•ä½**: duration å¿…é¡»æ˜¯åˆ†é’Ÿï¼ˆä¸æ˜¯å°æ—¶ï¼‰
4. **ä¿æŒå¼•ç”¨å®Œæ•´æ€§**: äº§å“ç¼–ç å¼•ç”¨å¿…é¡»å­˜åœ¨äºäº§å“åº“ä¸­
5. **ä¿æŒå·¥åºé¡ºåº**: tasks çš„ queue å¿…é¡»å•è°ƒé€’å¢

**å»ºè®®**: ä¼˜å…ˆé€šè¿‡å‰ç«¯ç•Œé¢é‡æ–°ç”Ÿæˆï¼Œè€Œä¸æ˜¯æ‰‹åŠ¨ä¿®æ”¹ã€‚

### 7. æµ‹è¯•å·¥ä½ (type=2) ä¸ºä»€ä¹ˆä¸åœ¨ config.resources ä¸­ï¼Ÿ

**ç­”**:

- `part_stations`: åªåŒ…å«éƒ¨è£…å·¥ä½ (type=0)
- `final_stations`: åªåŒ…å«æ€»è£…å·¥ä½ (type=1)
- **æµ‹è¯•å·¥ä½** (type=2): ä¸åœ¨è¿™ä¸¤ä¸ªåˆ—è¡¨ä¸­ï¼Œä½†åœ¨ `resources.stations` ä¸­å­˜åœ¨

è¿™æ˜¯è°ƒåº¦ç®—æ³•çš„è®¾è®¡è¦æ±‚ï¼Œæµ‹è¯•å·¥ä½ä½œä¸ºç‹¬ç«‹ç±»å‹å¤„ç†ã€‚

---

## ç›¸å…³æ–‡ä»¶

### å‰ç«¯æ–‡ä»¶

| æ–‡ä»¶è·¯å¾„ | è¯´æ˜ |
|---------|------|
| `frontend/src/utils/schedulingAdapter.ts` | æ•°æ®è½¬æ¢æ ¸å¿ƒé€»è¾‘ |
| `frontend/src/types/schedulingInput.d.ts` | TypeScript ç±»å‹å®šä¹‰ |
| `frontend/src/pages/SchedulingManagement/PlanMaking.tsx` | è°ƒç”¨ç”Ÿæˆæ¥å£çš„é¡µé¢ |

### åç«¯æ–‡ä»¶

| æ–‡ä»¶è·¯å¾„ | è¯´æ˜ |
|---------|------|
| `backend/src/controllers/schedulingTestController.js` | ä¿å­˜/è¯»å–è¾“å…¥æ–‡ä»¶çš„æ§åˆ¶å™¨ |
| `backend/src/routes/schedulingTestRoutes.js` | è¾“å…¥æ–‡ä»¶æ“ä½œè·¯ç”± |
| `backend/src/routes/productionTaskRoutes.js` | ç”Ÿäº§ä»»åŠ¡æ•°æ®è·å–è·¯ç”± |

### æ•°æ®åº“æ¨¡å‹

| æ¨¡å‹ | è¯´æ˜ |
|------|------|
| `ProductionTask` | ç”Ÿäº§ä»»åŠ¡ |
| `ScheduleStep` | ä»»åŠ¡æ‹†åˆ†æ­¥éª¤ |
| `Product` | äº§å“å®šä¹‰ |
| `Routing` | å·¥è‰ºè·¯çº¿ |
| `Process` | å·¥åºå®šä¹‰ |
| `Team` | ç­ç»„ |
| `Station` | å·¥ä½ |
| `Device` | è®¾å¤‡ |
| `CalendarEvent` | æ—¥å†äº‹ä»¶ |

### API æ¥å£

| æ¥å£ | æ–¹æ³• | è¯´æ˜ |
|------|------|------|
| `/api/production-tasks/:id/scheduling-input` | GET | è·å–è°ƒåº¦è¾“å…¥æ•°æ® (è½¬æ¢åçš„JSON) |
| `/api/scheduling-test/save-input` | POST | ä¿å­˜è¾“å…¥æ•°æ®åˆ° input_test.json |
| `/api/scheduling-test/get-input` | GET | è¯»å– input_test.json å†…å®¹ |

---

## ç‰ˆæœ¬å†å²

### v1.0 (2025-12-31)

- âœ… å®ç°å·¥åºç±»å‹åŠ¨æ€åŒ¹é… (GT/YT)
- âœ… ä¼˜åŒ–å·¥ä½ capabilities ç”Ÿæˆé€»è¾‘
- âœ… å®Œå–„æ•°æ®è½¬æ¢è§„åˆ™æ–‡æ¡£
- âœ… æ·»åŠ éªŒè¯è§„åˆ™å’Œç¤ºä¾‹

---

## åé¦ˆä¸æ”¯æŒ

å¦‚æœ‰é—®é¢˜æˆ–å»ºè®®ï¼Œè¯·è”ç³»å¼€å‘å›¢é˜Ÿæˆ–æäº¤ Issueã€‚

**æ–‡æ¡£ç»´æŠ¤**: æœ¬æ–‡æ¡£åº”éšä»£ç é€»è¾‘å˜æ›´åŒæ­¥æ›´æ–°ã€‚
